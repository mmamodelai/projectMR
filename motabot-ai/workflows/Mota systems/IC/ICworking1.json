{
    "nodes": [
      {
        "parameters": {
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.3,
        "position": [
          -672,
          64
        ],
        "id": "fc96c18d-e86a-431f-b4b8-c38644b3b97a",
        "name": "When chat message received",
        "webhookId": "6e33cc77-feb7-4359-8359-593f192b8031"
      },
      {
        "parameters": {
          "options": {
            "systemMessage": "You are a helpful MOTA dispensary assistant for the Silverlake location. When customers ask about their purchase history or product recommendations:\n\n1. First use 'Get Customer Profile' with their phone number to get their customer data\n2. Extract the 'id' field from the customer profile response - this is the customer_id (UUID format)\n3. Use 'Get Customer Transactions Silverlake' with the customer_id to get their transaction history\n4. For each transaction, use 'Get Transaction Items' with the transaction 'id' to get detailed purchase items\n5. Use 'Get Product Details' to search for specific products by name\n6. Use 'Get Available Products Silverlake' to show current inventory\n\nAlways provide helpful, friendly responses about their purchase history and suggest similar products based on their previous purchases. Remember that customer IDs and transaction IDs are UUIDs, not simple numbers."
          }
        },
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 2.2,
        "position": [
          -400,
          48
        ],
        "id": "3e4c5420-9a75-46be-9771-64485cac3ead",
        "name": "AI Agent"
      },
      {
        "parameters": {
          "model": "anthropic/claude-3.5-haiku",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
        "typeVersion": 1,
        "position": [
          -928,
          304
        ],
        "id": "e5d34a87-6fb0-4e46-8773-2ea67d10427e",
        "name": "OpenRouter Chat Model",
        "credentials": {
          "openRouterApi": {
            "id": "ToJIqxXt2y23vXOH",
            "name": "OpenRouter account 2"
          }
        }
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "Get customer profile by phone number. Returns customer data including id, name, phone, email, and total_points. Use the 'id' field from the response as customer_id for other queries.",
          "operation": "get",
          "tableId": "customers",
          "filters": {
            "conditions": [
              {
                "keyName": "phone",
                "keyValue": "={{ $fromAI('phone_number', 'Enter customer phone number', 'string') }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabaseTool",
        "typeVersion": 1,
        "position": [
          -688,
          304
        ],
        "id": "48b31861-428b-497e-ba56-e11b7d6be122",
        "name": "Get Customer Profile",
        "credentials": {
          "supabaseApi": {
            "id": "hwJ1to3Ot0D92Bo5",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "Get all transactions for a customer at Silverlake location. Use the customer 'id' field from Get Customer Profile response as customer_id. Returns transaction data including id, transaction_date, total_amount.",
          "operation": "getAll",
          "tableId": "transactions",
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "customer_id",
                "condition": "eq",
                "keyValue": "={{ $fromAI('customer_id', 'Enter customer ID (UUID) to get transactions', 'string') }}"
              },
              {
                "keyName": "shop_location",
                "condition": "eq",
                "keyValue": "MOTA (Silverlake)"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabaseTool",
        "typeVersion": 1,
        "position": [
          -528,
          320
        ],
        "id": "2d851609-7f43-4780-a356-dc4f848f1dd7",
        "name": "Get Customer Transactions Silverlake",
        "credentials": {
          "supabaseApi": {
            "id": "hwJ1to3Ot0D92Bo5",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "Get transaction items for a specific transaction by transaction ID. Use the transaction 'id' field from Get Customer Transactions response. Returns items including product_id, quantity, unit_price, total_price.",
          "operation": "getAll",
          "tableId": "transaction_items",
          "limit": 200,
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "transaction_id",
                "condition": "eq",
                "keyValue": "={{ $fromAI('transaction_id', 'Enter transaction ID (UUID) to get items', 'string') }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabaseTool",
        "typeVersion": 1,
        "position": [
          -352,
          336
        ],
        "id": "d5ab4118-baaa-4c48-b969-c2a4d555854e",
        "name": "Get Transaction Items",
        "credentials": {
          "supabaseApi": {
            "id": "hwJ1to3Ot0D92Bo5",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "descriptionType": "manual",
          "toolDescription": "Get product details by SKU or name - search for products",
          "operation": "getAll",
          "tableId": "products",
          "limit": 100,
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "name",
                "condition": "ilike",
                "keyValue": "={{ $fromAI('product_name', 'Enter product name to search', 'string') }}"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabaseTool",
        "typeVersion": 1,
        "position": [
          -176,
          304
        ],
        "id": "f6a1091a-b108-480a-be5c-8152b2bc15f7",
        "name": "Get Product Details",
        "credentials": {
          "supabaseApi": {
            "id": "hwJ1to3Ot0D92Bo5",
            "name": "Supabase account"
          }
        }
      },
      {
        "parameters": {
          "operation": "getAll",
          "tableId": "products",
          "limit": 100,
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "is_active",
                "condition": "eq",
                "keyValue": "true"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.supabaseTool",
        "typeVersion": 1,
        "position": [
          -16,
          304
        ],
        "id": "429a43a0-ca8a-4369-a645-149fb7ec1b59",
        "name": "Get Available Products Silverlake (NO STOCK)",
        "credentials": {
          "supabaseApi": {
            "id": "hwJ1to3Ot0D92Bo5",
            "name": "Supabase account"
          }
        }
      }
    ],
    "connections": {
      "When chat message received": {
        "main": [
          [
            {
              "node": "AI Agent",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenRouter Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "AI Agent",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Get Customer Profile": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Get Customer Transactions Silverlake": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Get Transaction Items": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Get Product Details": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Get Available Products Silverlake (NO STOCK)": {
        "ai_tool": [
          [
            {
              "node": "AI Agent",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      }
    },
    "pinData": {},
    "meta": {
      "templateCredsSetupCompleted": true,
      "instanceId": "daf1db1234fdfcbbfb53be5e1fe26764ab505fd0554977269bee03ef4bae6464"
    }
  }