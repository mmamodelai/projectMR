# MotaBot v5.300: Quick Start Guide ğŸš€

## ğŸ¯ **What Changed?**

### **v5.200 (Old)** âŒ
```
SMS â†’ Get customer data â†’ Pre-fetch everything â†’ Give to AI as text â†’ AI responds
```
**Problem:** AI got a text dump of data, couldn't actively search for specific info

### **v5.300 (New)** âœ…
```
SMS â†’ Give AI tools â†’ AI decides what to query â†’ Fetches from Supabase â†’ Responds
```
**Solution:** AI has 4 database query tools it can use on-demand!

---

## ğŸ”§ **The 4 Tools**

| Tool | What It Does | When AI Uses It |
|------|-------------|-----------------|
| **Get Customer Transactions** | Fetch transaction history | "What did I buy last time?" |
| **Get Transaction Items** | See items in a transaction | "Show me what was in order #549912" |
| **Search Products Purchased** | Find products customer bought | "Have I tried Blue Dream?" |
| **Calculate Spending** | Sum spending by date range | "How much did I spend this year?" |

---

## ğŸ“‹ **Setup in n8n (5 Steps)**

### **1. Create Tool Node #1: Get Customer Transactions**

```
Node Type: Code
Name: Get Customer Transactions Tool
Mode: Define Tool (AI Agent)
Tool Name: get_customer_transactions
Description: Query customer transaction history by phone number
Parameters:
  - phoneNumber (string, required)
  - limit (number, optional, default: 10)
```

Copy code from: `supabase_query_tools.js` lines 1-70

---

### **2. Create Tool Node #2: Get Transaction Items**

```
Node Type: Code
Name: Get Transaction Items Tool
Mode: Define Tool
Tool Name: get_transaction_items
Description: Get items purchased in a specific transaction
Parameters:
  - transactionId (string, required)
```

Copy code from: `supabase_query_tools.js` lines 72-145

---

### **3. Create Tool Node #3: Search Products Purchased**

```
Node Type: Code
Name: Search Products Purchased Tool
Mode: Define Tool
Tool Name: search_products_purchased
Description: Search what products a customer has purchased
Parameters:
  - phoneNumber (string, required)
  - searchTerm (string, optional)
  - category (string, optional)
```

Copy code from: `supabase_query_tools.js` lines 147-228

---

### **4. Create Tool Node #4: Calculate Spending**

```
Node Type: Code
Name: Calculate Spending Tool
Mode: Define Tool
Tool Name: calculate_spending
Description: Calculate total spending with optional date filtering
Parameters:
  - phoneNumber (string, required)
  - startDate (string, optional, YYYY-MM-DD)
  - endDate (string, optional, YYYY-MM-DD)
```

Copy code from: `supabase_query_tools.js` lines 230-315

---

### **5. Connect to AI Agent**

```
[Tool 1] ----\
[Tool 2] -----\
[Tool 3] -------> [AI Agent Node]
[Tool 4] -----/
```

Update AI Agent:
- System Message: Copy from `system_prompt_v5.300.txt`
- Model: `google/gemini-flash-1.5`

---

## ğŸ§ª **Test It!**

### **Test 1: Simple Query**
```
SMS: "What did I buy last time?"
Expected: "On Oct 9th you got Blue Dream 3.5g, LA Kush vape, and a pre-roll for $53!"
```

### **Test 2: Spending**
```
SMS: "How much have I spent?"
Expected: "You've spent $140.76 across 3 visits!"
```

### **Test 3: Product Search**
```
SMS: "Have I bought Gorilla Glue?"
Expected: "Yes! You bought Gorilla Glue #4 on Sept 22nd."
```

---

## ğŸ’¡ **How It Works**

```
Customer: "What did I buy on my last 3 visits?"
           â†“
AI thinks: "I need transaction history for 3 visits"
           â†“
AI calls: get_customer_transactions(phone="+16199773020", limit=3)
           â†“
Supabase returns: [Transaction 1, Transaction 2, Transaction 3]
           â†“
AI calls: get_transaction_items(transactionId="549912")
AI calls: get_transaction_items(transactionId="549911")
AI calls: get_transaction_items(transactionId="549910")
           â†“
AI composes: "Visit 1: Blue Dream, LA Kush. Visit 2: Gorilla Glue, gummies. Visit 3: Pre-rolls!"
           â†“
Response sent via SMS
```

---

## ğŸ“Š **Benefits**

âœ… **Accurate** - Real data from Supabase, no hallucinations
âœ… **Scalable** - Works with 10,000+ customers
âœ… **Flexible** - AI chooses tools based on question
âœ… **Natural** - Conversational interface
âœ… **Efficient** - Only fetches what's needed

---

## ğŸ“ **File Locations**

```
motabot-ai/
â”œâ”€â”€ workflows/
â”‚   â””â”€â”€ code-snippets/
â”‚       â”œâ”€â”€ supabase_query_tools.js      â† Tool code (copy to n8n)
â”‚       â””â”€â”€ system_prompt_v5.300.txt     â† AI instructions (copy to n8n)
â””â”€â”€ docs/
    â”œâ”€â”€ DATABASE_QUERY_AGENT_SETUP.md    â† Detailed guide
    â””â”€â”€ V5.300_QUICK_START.md            â† This file
```

---

## ğŸš€ **Ready?**

1. Open n8n
2. Create the 4 tool nodes
3. Connect to AI Agent
4. Update system prompt
5. Test with SMS!

**Full details:** See `DATABASE_QUERY_AGENT_SETUP.md`

---

**This is your database-powered AI agent!** ğŸŠ

